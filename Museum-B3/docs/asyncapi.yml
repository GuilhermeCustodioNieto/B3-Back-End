asyncapi: '2.6.0'
info:
  title: Museu B3 – Quiz WS API
  version: '1.0.0'
  description: API em tempo real do quiz via STOMP sobre WebSocket.
servers:
  local:
    url: ws://localhost:8080/ws
    protocol: stomp

channels:
  /topic/rooms/{roomCode}:
    description: Broadcast de eventos do quiz para a sala
    parameters:
      roomCode:
        schema: { type: string }
    subscribe:
      message:
        oneOf:
          - $ref: '#/components/messages/QuestionEvent'
          - $ref: '#/components/messages/ScoreboardEvent'

  /app/rooms/{roomCode}/answer:
    description: Envio de resposta do jogador
    parameters:
      roomCode:
        schema: { type: string }
    publish:
      message:
        $ref: '#/components/messages/AnswerMessage'

components:
  schemas:
    Alternative:
      type: object
      properties:
        id: { type: integer, format: int64 }
        text: { type: string }
        format: { type: string, enum: [TRIANGLE, CIRCLE, SQUARE, DIAMOND] }

  messages:
    QuestionEvent:
      name: QuestionEvent
      payload:
        type: object
        properties:
          type: { type: string, example: QUESTION }
          text: { type: string, example: "O que é uma ação?" }
          alternatives:
            type: array
            items: { $ref: '#/components/schemas/Alternative' }
          index: { type: integer, example: 1 }
          total: { type: integer, example: 10 }
          timeLimitSec: { type: integer, example: 15 }

    ScoreboardEvent:
      name: ScoreboardEvent
      payload:
        type: object
        properties:
          type: { type: string, example: SCOREBOARD }
          scores:
            type: object
            additionalProperties: { type: integer }
          finished: { type: boolean, example: false }

    AnswerMessage:
      name: AnswerMessage
      payload:
        type: object
        properties:
          username: { type: string, example: "guilherme" }
          format: { type: string, enum: [TRIANGLE, CIRCLE, SQUARE, DIAMOND], example: "CIRCLE" }
